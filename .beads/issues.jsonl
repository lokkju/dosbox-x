{"id":"DBX-18m","title":"Add integration tests for GDB/QMP servers","description":"Create external integration tests (Python scripts) that connect to the GDB and QMP servers and verify basic functionality. Avoids need for refactoring code for unit testability.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-17T00:29:09.2390112-08:00","updated_at":"2025-12-17T00:29:09.2390112-08:00"}
{"id":"DBX-3da","title":"Rename C_GDBSERVER to C_REMOTEDEBUG","description":"Rename the build flag from C_GDBSERVER to C_REMOTEDEBUG to better reflect that it covers both GDB remote debugging and QMP keyboard input protocols.","status":"closed","priority":1,"issue_type":"chore","created_at":"2025-12-16T22:32:20.413564306-08:00","updated_at":"2025-12-16T22:41:32.354244916-08:00","closed_at":"2025-12-16T22:41:32.354244916-08:00","close_reason":"Renamed C_GDBSERVER to C_REMOTEDEBUG across all files","dependencies":[{"issue_id":"DBX-3da","depends_on_id":"DBX-mbt","type":"blocks","created_at":"2025-12-16T22:32:20.414630321-08:00","created_by":"daemon"}]}
{"id":"DBX-azs","title":"GDB server handshake fails with dbxdebug client","description":"When connecting with dbxdebug 0.2.1 Python client, the GDB server logs:\n```\nGDBServer: Client connected\nGDBServer: Unexpected initial packet - \nGDBServer: Handshake failed\n```\n\nThe client sends a valid qSupported packet with correct checksum, but the server receives an empty string. This suggests either:\n1. Checksum mismatch causing receive_packet() to return \"\"\n2. Some bytes being lost/corrupted in transmission\n3. Encoding issue between Python bytes and C++ char","design":"Investigation needed:\n1. Add LOG_DEBUG output in receive_packet() to show raw bytes received\n2. Log the calculated vs received checksum values\n3. Test with raw telnet/netcat to isolate client vs server issue\n4. Compare with GDB proper to see if it works","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-18T16:49:20.439712671-08:00","updated_at":"2025-12-18T18:12:41.398395404-08:00","closed_at":"2025-12-18T18:12:41.398395404-08:00","close_reason":"Fixed - was caused by noack_mode persisting between client connections; now reset on disconnect","labels":["gdbserver","handshake"]}
{"id":"DBX-k6u","title":"GDB server crashes on toggle due to use-after-free","description":"DEBUG_StopGDBServer() deletes gdbServer immediately after calling stop(), but the detached server thread is still running and will access freed memory when its blocking accept()/read() call returns.\n\nThe crash occurs when toggling Debug \u003e GDB Server menu item while a client was connected or the server is blocked.","design":"Fix options:\n1. Use a joinable thread instead of detached, call join() after stop()\n2. Add a condition variable for clean shutdown signaling\n3. Use shared_ptr or ensure thread exits before delete\n\nRecommended: Option 1 - change to joinable thread:\n- Store std::thread in GDBServer class\n- Add join() method that waits for thread to exit\n- In stop(), set running=false, close sockets (unblocks thread), then join\n- Call join() from DEBUG_StopGDBServer() before delete","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-18T16:49:20.31226014-08:00","updated_at":"2025-12-18T18:12:41.183242695-08:00","closed_at":"2025-12-18T18:12:41.183242695-08:00","close_reason":"Fixed - server thread is now joinable and stop() waits for it to exit before deleting the object","labels":["crash","gdbserver","threading"]}
{"id":"DBX-mbt","title":"Implement QMP-compatible keyboard input protocol","description":"Add a QEMU QMP-compatible protocol for keyboard input injection, separate from the GDB stub. This allows use of existing QEMU tooling and provides a cleaner separation of concerns.\n\nKey components:\n- JSON-based protocol on separate socket\n- send-key command with hold-time support\n- input-send-event for explicit press/release control\n- QKeyCode-compatible key names mapped to DOSBox KBD_KEYS","design":"## Protocol Design\n\nUse QEMU's QMP subset:\n- `send-key`: Array of keys pressed simultaneously, auto-release after hold-time\n- `input-send-event`: Explicit key down/up events\n\n## Key Name Mapping\n\nMap QEMU QKeyCode names to DOSBox KBD_KEYS enum values via static lookup table.\n\n## Implementation Plan\n\n1. Create `include/qmp.h` - QMPServer class declaration\n2. Create `src/debug/qmp.cpp` - QMP server implementation\n   - Socket handling (reuse pattern from gdbserver)\n   - JSON parsing (minimal, just what we need)\n   - Key mapping table\n   - send-key command\n   - input-send-event command\n3. Update `src/debug/Makefile.am` - add qmp.cpp\n4. Update `configure.ac` - gate behind C_QMPSERVER or reuse C_GDBSERVER\n5. Update `src/dosbox.cpp` - add qmp config options\n6. Update `src/debug/debug.cpp` - startup/shutdown\n7. Update docs/GDBSERVER.md or create docs/QMP.md","notes":"Implementation complete. QMP server with send-key and input-send-event commands. Renamed C_GDBSERVER to C_REMOTEDEBUG. Documentation updated.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-16T22:23:09.068905908-08:00","updated_at":"2025-12-16T22:43:39.476902161-08:00","closed_at":"2025-12-16T22:43:39.476902161-08:00","close_reason":"QMP keyboard input protocol implemented and documented"}
{"id":"DBX-z6v","title":"GDB step/continue don't execute from separate thread","description":"DEBUG_Step() and DEBUG_Continue() call DEBUG_CheckKeys() to simulate F11/F5 keypresses in the debugger, but when called from the GDB server thread, the main emulator loop doesn't process them.\n\nResult: step command returns S05 response but EIP doesn't change - the instruction isn't actually executed.\n\nThis is a threading/synchronization issue between the GDB server thread and the main emulator thread.","design":"Options:\n1. Use a condition variable or event to signal the main thread to execute step/continue\n2. Have the GDB server set a flag that the main loop checks\n3. Use SDL events to communicate with main thread\n4. Refactor debugger to be thread-safe\n\nThe proper fix likely requires main loop integration rather than just simulating keypresses.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-18T18:10:20.693056402-08:00","updated_at":"2025-12-18T18:10:20.693056402-08:00","labels":["gdbserver","threading"]}
